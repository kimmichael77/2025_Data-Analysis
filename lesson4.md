## 4. 주성분분석 Principle Component Analysis

### 4.1. 개관

주성분분석이란 여러 개의 변수들로 이루어진 다변량 자료에서 서로 독립적인 새로운 성분을 도출하여 원래 변수들이 가지고 있는 변이(정보)를 축약하고, 다변량 변이의 구조를 분석하는 방법을 말한다. (다변량분석, 김성수 등, 2014, 한국방통대출판문화원, 33)

일반적으로 다변량 분석방법을 다루거나 기계학습 분야에서 비지도학습을 다룰 때에 가장 먼저 다루는 분석 방법이 주성분분석이다. 주성분분석은 여러 개의 변수들이 가지고 있는 변동을 유사한 부류끼리 묶어서 **변수의 차원을 축소**하는 유형의 분석방법 중 가장 쉽고 이해가 쉬운 분석 방법이다. 또한, 회귀분석이 상정하는 **선형함수에서 벗어나 다른 종류의 수리적인 근거를 가지고 변수 간의 연결관계를 발견**한다는 점에서 데이터를 다루는 다양한 방법에 대한 새로운 차원을 제공해준다는 점에서 데이터 분석을 공부하는 학생들에게 의미가 있다고 할 수 있다.

#### 4.1.1. 주성분분석의 원리

주성분분석은 변수의 상관계수행렬을 고유값분해하여 생성한 고유벡터를 가중값으로 삼아 새로운 주성분을 생성하는 분석방법이다. $n \times p$, $n \ll p$인 데이터를 주성분분석하는 과정은 아래의 수식으로 나타낼 수 있다.

p개의 변수에 대한 상관계수행렬을 $\boldsymbol X$라고 할 때, $\boldsymbol X$는 ($p \times p$)차원의 행렬로 아래와 같은 형태를 가진다.

```math
\boldsymbol X = \begin{pmatrix}
1 & \rho_{12} & \cdots & \rho_{1p} \\
\rho_{12} & 1 & \cdots & \rho_{2p} \\
&&\vdots \\
\rho_{1n} & \rho_{2n} & \cdots & 1 \\
\end{pmatrix}
```

위 정방행렬에 대해 아래의 식을 만족하는 $\boldsymbol u$와 $\lambda$를 각각 고유벡터와 고유값이라고 부른다. ($\boldsymbol u$는 ($p \times 1$)차원)

```math
\boldsymbol {X u} = \lambda \boldsymbol u
```

상관계수행렬은 성질상 (고유값, 고유벡터)를 p개 가진다. 이들 (고유값, 고유벡터)의 조합을 고유값의 크기에 따라 내림차순으로 정렬한 후 i번째 조합을 ($\lambda_i$, $\boldsymbol u_i$)라고 할 때, 

```math
PC_i = \boldsymbol {X u_i}
```

를 i번째 주성분이라고 부른다. (고유값, 고유벡터) 조합은 p개가 있기 때문에 p개 변수로 구성된 데이터의 주성분은 p개까지 존재한다.

---

#### 4.1.2. 주성분의 구성 : 고유벡터

i번째 고유벡터 $\boldsymbol u_i$가 ($p \times 1$)차원의 벡터로 p개의 원소로 구성된다. 주성분은 다음과 같이 j번째 변수와 j번째 원소의 곱으로 표현할 수 있다.

```math
\begin{aligned}

PC_i &= \sum_{j = 1}^p u_{ij} \boldsymbol x_j\\

&= u_{i1} \boldsymbol x_1 + u_{i2} \boldsymbol x_2 + \cdots + u_{i(p-1)} \boldsymbol x_{(p-1)} + u_{ip} \boldsymbol x_p

\end{aligned}
```

위 식은 j번째 변수 $\boldsymbol x_j$에 상수 $u_{ij}$값을 가중치로 곱한 값을 합한 것이 i번째 주성분임을 보여준다. 즉, 주성분은 기존 변수를 선형결합한 값이다. 

위 식을 살펴보면 ($p \times 1$) 차원의 벡터인 $\boldsymbol x_j$가 상수 $u_{ij}$와 결합하여 1차원의 스칼라값으로 변화하는 것을 알 수 있다. 즉, 고유벡터를 이용하여 p차원의 데이터가 1차원의 스칼라값으로 차원축소가 되는데, 이 성질을 이용하여 k개의 주성분($k < p$)을 선택해서 데이터의 변동을 설명하면 p차원의 다변량데이터를 k차원으로 축소할 수 있다. 이러한 주성분의 성질을 이용하여 다차원 데이터의 본질을 2개의 주성분 좌표평면으로 나타낼 수 있는데, 이러한 시각화 방법을 바이플롯(biplot)이라고 한다.

---

#### 4.1.3. 주성분의 중요도를 판단하는 기준 : 고유값

전체 데이터의 변동 중에서 j번째 주성분이 가지는 중요도를 다음과 같은 고유값의 비율로 표시할 수 있다.

```math
r_i = \frac {\lambda_i} {\lambda_1 + \lambda_2 + \cdots + \lambda_p}
```
주성분의 순서는 고유값의 크기순으로 결정되기 때문에 $\lambda_1 > \lambda_2 > \cdots > \lambda_p$가 성립한다. 따라서, 각 주성분의 중요도의 비율 역시 $r_1 > \cdots > r_p$의 관계가 성립한다.

고유값의 크기는 전체 데이터가 가지는 총분산 중에서 고유벡터가 설명할 수 있는 양이라고 이해할 수 있다. 따라서 고유값이 가장 큰 첫 번째 주성분 $PC_1$이 전체 데이터의 변동분 중 가장 많은 분량을 설명할 수 있고, $PC_2, PC_3 \cdots$순서로 데이터의 변동량을 설명할 수 있는 크기가 작아진다. 주성분의 순서에 따라 각 주성분의 중요도를 누적하여 계산하면 몇 번째 주성분까지 이용했을 때에 전체 데이터 변동분의 어느 정도 비율을 설명하는지를 확인할 수 있는데, 이 성질을 이용하면 데이터 변동분 중 설명할 수 없는 양을 어느 정도 선에서 포기하고 차원의 수를 줄여 데이터의 변화를 설명할 수 있는 새로운 변수 체계를 만들 수 있다. 통상 80~90% 선을 만족하는 개수의 주성분을 선택한다.

하지만 가이드라인이 없는 주성분분석의 특성상 주성분을 몇 개 선택했을 때에 데이터의 변동분을 '충분히' 설명할 수 있는지를 판단하기 어려운데, 가장 손쉬운 방법은 고유값이 줄어드는 크기가 급격하게 줄어드는 구간에서 주성분의 개수를 선택하는 방법이다. 이때에 사용하는 시각화 자료를 스크리 플롯(scree plot)이라고 하는데, 주성분의 순서에 따라 각 주성분에 대응하는 고유값을 세로축에 표시한다. 스크리 플롯을 이용하는 경우 고유값의 연결선 기울기가 급격하게 완만해지는 구간에서 주성분의 수를 선택한다.

---


### 4.2. 주성분분석의 수학적 기초

#### 4.2.1. 상관계수행렬과 분산/공분산 행렬

다차원의 데이터가 가지고 있는 성질 중 '변동'의 성질을 잘 보여주는 행렬은 분산/공분산 행렬이다. p개의 변수로 이루어진 데이터의 분산/공분산 행렬은 다음과 같이 구성된다.

```math
\boldsymbol V =  \begin{pmatrix}
\sigma_1^2 & Cov(X_1, X_2) & Cov(X_1, X_3) & \cdots & Cov(X_1, X_p) \\

Cov(X_2, X_1) & \sigma_2^2 & Cov(X_2, X_3) & \cdots & Cov(X_2, X_p) \\

&& \vdots \\

Cov(X_p, X_1) & Cov(X_p, X_2) & Cov(X_p, X_3) & \cdots & \sigma_p^2 

\end{pmatrix}
```

위 행렬은 다음의 성질을 가지고 있다. 

첫째, 데이터가 가지고 있는 변수 고유의 흩어짐의 총량(분산)과 각 데이터쌍이 서로 연동하여 변화하는 체계(공분산)에 대한 정보를 모두 가지고 있다. 즉, '변동'의 측면에서 데이터가 가지고 있는 모든 체계적인 정보를 가지고 있는 것이 분산/공분산 행렬이다.

둘째, 대각선 원소를 기준으로 우상방에 있는 값과 좌하방에 있는 값이 대칭을 이루고 있다. 이와 같은 행렬을 **대칭행렬**이라고 한다. 대칭행렬은 (1) 고유값이 모두 실수이고, (2) [고유벡터가 서로 직교한다.](#423-대칭행렬에서-고유벡터의-성질--스펙트럼-정리) 

셋째, 분산/공분산행렬에 임의의 벡터를 제곱하면 항상 0보다 큰 값이 나오는데, 이러한 성질의 행렬을 **양정칙** 또는 **양의 정부호**라고 부른다. (분산/공분산 행렬에 임의의 벡터(데이터 세트)를 제곱하면 그 벡터의 분산값이 나오기 때문에 항상 0보다 커진다고 직관적으로 이해하시면 됩니다.) 대칭행렬이 양정칙행렬이면 모든 고유값이 0보다 크거나 같아진다. 따라서, 분산/공분산 행렬을 이용하여 고유값분해를 하면 고유값은 항상 0 또는 자연수가 나온다.

한편, 변수를 표준화하면 분산이 1로 바뀌고 각 데이터값은 다음과 같이 바뀌는데,

```math
\boldsymbol Z_{ij} = \frac {\boldsymbol X_{ij}} {\sqrt {Var(X_j)}}
```

이 관계를 원데이터 행렬 $\boldsymbol X$와 $\boldsymbol Z$의 관계로 연결하면 다음과 같이 나타낼 수 있다.

```math
\boldsymbol Z = \boldsymbol {X D^{-\frac 1 2}}
```

여기서 $\boldsymbol D$는 각 변수의 분산을 대각원소로 하고 나머지 모든 원소가 0인 대각행렬이다. 표준화가 이루어지면 평균이 0이 되기 때문에 분산/공분산 행렬을 다음과 같이 구할 수 있다.

```math
\boldsymbol \Sigma_Z = \frac 1 n \boldsymbol {Z'Z} = \frac 1 n D'^{-\frac 1 2} X' X D^{-\frac 1 2} = D'^{-\frac 1 2} \boldsymbol \Sigma_X D^{-\frac 1 2}
```

즉, 표준화한 데이터 행렬의 분산/공분산 행렬은 원데이터의 분산/공분산 행렬을 각 행과 열에 대응하는 표준편차로 나눠준 값이 된다. 이때, 위 행렬의 원소는 다음과 같이 나타낼 수 있다.

```math
Z_{ij} = \frac {Cov(X_i, X_j)} {\sqrt{Var(X_i)} \sqrt{Var(X_j)}} = \rho_{ij}
```

결과적으로 데이터를 표준화한 후의 분산/공분산행렬은 각각의 원소가 상관계수가 된다. 따라서, 표준화 후의 분산/공분산행렬은 상관계수행렬과 같아진다.

---

#### 4.2.2. 고유값행렬과 고유값의 수리적인 의미

고유값분해는 통해 정방행렬이 가지는 변환의 성질을 이해할 수 있게 해준다. 행렬을 입력 벡터와 출력 벡터 사이의 변환장치라고 이해했을 때에, 정방행렬은 입력 벡터와 출력 벡터의 차원이 동일하기 때문에 차원의 변화는 일어나지 않는다. 대신, 동일한 차원에서 공간의 변형이 일어나는데, 공간의 변형이 어떤 차원에서 어떤 크기로 일어나는지를 이해할 수 있도록 도와주는 틀이 고유행렬과 고유값이다.

```math
\boldsymbol A = \boldsymbol {V' \Lambda V}
```

이때, $\boldsymbol V$는 고유벡터를 열벡터로 가지는 행렬이고, $\boldsymbol \Lambda$는 고유벡터에 대응하는 고유값을 대각원소로 가지는 대각행렬이다.

아래의 ($2 \times 2$) 행렬의 예를 들어보자.(선형대수, 손진곤 등, 2017, 한국방송통신대학교출판문화원, p. 297)  

```math

\boldsymbol M = \begin{pmatrix}
1 & 1 \\
3 & -1 \\
\end{pmatrix}

\qquad

\boldsymbol a = \begin{pmatrix}
1 \\
2 \\
\end{pmatrix}

\qquad

\boldsymbol b = \begin{pmatrix}
1 \\
1 \\
\end{pmatrix}

\qquad

\boldsymbol c = \begin{pmatrix}
1 \\
-3 \\
\end{pmatrix}
```

```math
\begin{aligned}

\boldsymbol {Ma} &= \begin{pmatrix} 1 & 1 \\ 3 & -1 \\ \end{pmatrix} \begin{pmatrix} 1 \\ 2 \end{pmatrix} = \begin{pmatrix} 3 \\ 1 \end{pmatrix} \\

\boldsymbol {Mb} &= \begin{pmatrix} 1 & 1 \\ 3 & -1 \\ \end{pmatrix} \begin{pmatrix} 1 \\ 1 \end{pmatrix} = \begin{pmatrix} 2 \\ 2 \end{pmatrix} = 2 \boldsymbol b\\ 

\boldsymbol {Mc} &= \begin{pmatrix} 1 & 1 \\ 3 & -1 \\ \end{pmatrix} \begin{pmatrix} 1 \\ -3 \end{pmatrix} = \begin{pmatrix} -2 \\ 6 \end{pmatrix} = -2 \boldsymbol c

\end{aligned}
```

$\boldsymbol a$와 달리 $\boldsymbol b, \boldsymbol c$는 행렬 $\boldsymbol M$과 곱의 결과를 원래 벡터 자신과 상수를 곱한 형태로 나타낼 수 있다. 즉, 공간변환 장치로서 $\boldsymbol M$의 성질을 확인하기 위해서 (1) 어떤 방향으로, (2) 얼마나 크게 변환이 이루어지는지를 나타내야 하는데, 위 결과를 바탕으로 행렬 $\boldsymbol M$은 2차원 벡터를 (1) 벡터 $\boldsymbol b$의 방향으로 2만큼, (2) 벡터 $\boldsymbol c$의 방향으로 -2만큼 변환시킨다고 해석할 수 있다. 즉, '변환'의 관점에서 행렬을 평가했을 때에 어떤 벡터의 방향으로 얼마나 큰 변화가 일어나는지를 파악할 수 있도록 도와주는 장치가 고유벡터와 고유값이다.

이러한 성질을 데이터의 분해와 연결하면 데이터의 '변동'을 특정 벡터와 특정 값의 곱으로 표현할 수 있는 (벡터, 상수)의 쌍이 존재하는데 이 조합을 찾아내면 데이터가 가지고 있는 변동량의 전체를 파악할 수 있다. 이렇게 구한 벡터의 본질을 이해하기 위해 각 변수에 해당하는 벡터 원소값과 변수의 곱의 형태로 벡터를 표현할 수 있는데, 이렇게 표현한 벡터를 '주성분'이라고 이해할 수 있다.

---

#### 4.2.3. 대칭행렬에서 고유벡터의 성질 : 스펙트럼 정리

스펙트럼 정리란, 대칭인 행렬은 직교하는 행렬로 다음과 같이 분해할 수 있다는 정리이다. (증명은 생략)

```math
\boldsymbol A = \boldsymbol {Q' \Lambda Q}, \ \boldsymbol{Q' Q} = \boldsymbol I
```

즉, 대칭행렬을 고유값분해하면 고유벡터로 이루어진 행렬이 직교한다. 고유벡터가 직교하는 성질은 주성분분석에서 다음과 같은 특징으로 이어진다.

첫째, 직교하는 두 벡터의 내적은 0이다. 즉, 두 개의 주성분값을 각각의 원소에 따라 곱한 값의 합은 0이 된다. 이 때문에 주성분 쌍의 공분산은 0이 되고(표준화한 데이터에서 주성분의 값을 구하기 때문에, 각 변수값의 선형결합인 주성분의 평균은 0이 됩니다. 그래서 두 주성분의 곱의 기댓값이 0이기 때문에 주성분 쌍의 공분산은 0이 됩니다.), 상관계수 역시 0이 된다. 이때, 모든 데이터가 정규분포를 따른다면 주성분은 다변량 정규분포를 따르기 때문에 두 주성분은 독립이라고 할 수 있다.

둘째, 기하학적으로 표현하면 직교하는 두 벡터는 직각이다. 따라서, 데이터 행렬의 주성분을 구하면 각각의 주성분은 서로 직교관계에 있으며, 1번 주성분과 2번 주성분의 관계를 직각으로 나타내는 바이플롯으로 표현할 수 있다. (이 관계는 어느 주성분을 축으로 하더라도 적용할 수 있습니다.) 

---

### 4.3. 주성분분석 해석 방법

> 노트북 참조

---

### 4.4. 주성분분석 활용

#### 4.4.1. 활용예시

주성분분석은 다차원 데이터를 단순화하거나 변수 간의 관계를 해석하기 위한 중간 단계의 분석도구로 매우 널리 활용된다. 유전자, 광학스펙트럼, 주파수 데이터 등 데이터의 각 구성요소의 역할이나 구성요소 간의 관계가 매우 불확실한 연구에서 주성분분석은 1차적인 연결관계를 유추할 수 있게 해주는 도구로 자주 활용된다. 변수의 이름이나 역할이 제한되지 않은 경우에도 주성분분석을 활용하여 다수의 변수를 차원축소 및 일반화하여 해석하는 용도로 활용할 수 있다. (활용예시 : [한국인의 의복 제작을 위한 체형별 사이징 체계 개발, 성덕현 등, 2005, 대한인간공학회지](https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://koreascience.kr/article/JAKO200516049040198.pdf&ved=2ahUKEwifgsiCw-ePAxU0UfUHHc6wA4EQFnoECBAQAQ&usg=AOvVaw2eKcqeqvVRhfQHzzsST_K9))

---

#### 4.4.2. 한계

주성분분석이 가지는 가장 큰 단점은 해석의 기준이 없다는 점이다. 주성분분석을 활용하는 가장 일반적인 방법은 소수의 주성분(주로 2개)을 선택하여 원변수의 선형결합관계를 해석하여 새로운 성분을 정의하거나 주성분을 변수로 하는 선형회귀모형을 적합하여 반응변수와의 관계를 확인하는 방법이다. 그런데 두 가지 방법 모두 주성분이 원변수와의 관계에서 어떤 의미를 가지는지 주관적으로 해석해야한다는 장애물이 있다. 만약, 원변수와 주성분의 관계가 명확하다면 해석에 큰 어려움이 없겠지만, 그렇지 않다면 주성분이 어떤 의미를 가지고 있는지 정의하는 것이 매우 어렵다. 이러한 한계는 주성분분석뿐만 아니라 모든 비지도학습 계열의 데이터 분석 방법이 공유하는 한계이기도 하다.

주성분분석의 두 번째 문제는 데이터의 구조에 따라서 고유값이 균등하게 배분되는 사례가 생길 수 있다는 점이다. 이 경우 주성분분석을 통해 원변수의 차원을 축소하는 것이 매우 어려워지는데, 스크리플롯을 기준으로 절단면을 찾기가 어렵고 누적 중요도를 기준으로 주성분의 수를 선택하기에도 기준점 앞의 주성분과 뒤의 주성분 사이에는 임의적인 구분 외에 수리적인 차별점이 존재하지 않기 때문이다. 이러한 상황은 원변수 간의 독립성이 매우 높은 자료에서 발생한다.

마지막으로 주성분분석을 통해 확인할 수 있는 것은 데이터 전체의 변동관계지 변수의 역할이 아니다. 주성분의 순서는 전체 데이터의 '변동'을 가장 잘 설명할 수 있는 벡터의 순서이지 각 주성분에 포함된 원변수의 역할이 아니다. 그래서 고유값이나 누적 중요도를 바탕으로 주성분을 선택했을 때에 후순위에 있는 주성분이 버려지는데, 만약 후순위에 있는 주성분에 구성비율이 높은 변수가 있는 경우에 해당 변수가 전체 데이터와 연관성은 적지만 연구의 핵심 주제와 직결되는 성질(특히, 데이터에 포함되지 않은 성질)을 가지고 있을 수 있다. 이러한 문제는 범주형 변수와 연속형 변수가 혼합되어있는 데이터에서 두드러지는데, 2범주형 변수의 경우 최대 분산이 0.25이기 때문에 연속형변수보다 분산의 크기가 작을 수밖에 없다. 이 경우에는 범주형 변수의 차원을 변환하는 형태의 분석방법을 사용한다.

---

### 4.5. 결론

주성분분석은 행렬의 분해라는 이론적 근거를 가지고 데이터를 해석하는 새로운 관점을 제공해주며, 다차원 데이터의 차원을 극적으로 줄일 수 있다는 점에서 $n \ll p$인 데이터뿐만 아니라 단순히 p가 큰 데이터에 대해서도 활용성이 매우 높은 분석 방법이라고 할 수 있다. 활용과 해석 역시 단순하면서도 강력한 의미를 가지기 때문에 실제 분석에서도 다양하게 활용되는 분석 기법이다.

반면 객관적이고 과학적인 판단의 기준이 없다는 점은 주성분분석의 활용을 어렵게 만드는 장애물이다. 이 점은 주성분분석뿐만 아니라 앞으로 살펴볼 인자분석, 다차원척도법, 군집분석, 트리분석 등 거의 대부분의 다변량 데이터 분석방법이 공유하는 특성이기도 하다. 원데이터가 여러 개의 변수로 분리되어있어 직관적으로 이해할 수 없지만 모종의 연관관계가 있는 경우, 다변량데이터 분석기법 중 차원축소와 단순화를 핵심으로 하는 분석기법은 변수가 가지고 있는 일부 정보를 버리는 대신에 변수 속에서 다른 의미를 찾아낸다. 이러한 계열의 분석기법은 어떤 정보를 버리고 어떤 정보를 취할 것이냐에 따라서 타당성의 정도가 달라질 수 밖에 없는데, 결국 분석이 타당한가를 결정하는 기준이 외생적이라는 점에서 분석방법 자체의 정교함과 과학적인 성격보다는 분석가의 전문성에 분석 방법의 실효성이 좌우된다고 할 수 있다. 따라서, (많은 데이터 분석 방법들이 그런 것처럼) 분석의 대상이 되는 업무영역에 대한 도메인 지식이 분석의 타당성을 결정할 수 있는 밑거름이 된다. 이 때문에 데이터 분석 방법의 정교함이나 화려함을 추구하기보다는, 도메인 영역에 대한 이해를 가지고 단순한 분석 방법을 적용한 연구나 분석이 훨씬 더 현실의 문제를 해결하는 데에 도움이 될 수 있다.